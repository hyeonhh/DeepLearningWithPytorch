# Chpater 9 : Using PyTorch to fight cancer
## 9.3 CT 스캔이란?
- CT 스캔은 단일 채널의 3차원 배열로 표현되는 3차원 액스레이, 흑백 png 이미지를 차곡차곡 쌓아놓은 것과 유사함.
- CT 스캔 내 각 복셀은 해당 위치에 있는 물체의 평균 질량 밀도를 나타내는 숫자값(voxel)을 가진다.
  - 밀도가 높은 뼈나 금속 임플란트는 하얀색
  - 밀도가 낮은 공기나 폐 조직은 검은색
  - 지방이나 조직은 밝기가 다양한 회색

- CT vs xray
  - xray : 3차원적인 강도를 2차원 평면에 투영
  - CT : 데이터의 3차원 형태 보존
 
- 이와 같은 3차원 데이터 표현을 통해 관심없는 조직을 숨겨서 대상의 내부를 들여다볼 수 있다.
-  <img width="448" height="283" alt="image" src="https://github.com/user-attachments/assets/0aa37891-04c6-45e1-a57c-3e6c8eed71c4" />

- <img width="654" height="313" alt="image" src="https://github.com/user-attachments/assets/8f8e444c-fbf3-492a-8ffe-192b0d0d307e" />
- CT 스캔 데이터가 해당하는 부분 그림이다.
- 환자를 받치고 있는 침대가 앞뒤로 움직이면 스캐너는 환자의 단층 사진을 여러 장 만들어 박스를 채워간다.

 - CT와 xray의 두 번째 차이 : CT는 데이터가 디지털 포맷이라는 점.

## 9.4 프로젝트 :엔드투엔드 폐암 진단기
<img width="637" height="458" alt="image" src="https://github.com/user-attachments/assets/4a6a5d62-5695-47d8-976c-c6abf5a0da6c" />
- 결절의 위치 정보는 CT 복셀 데이터 뒤에 붙어 후보가 되고 이 후보들은 결절을 분류하는 모델에 의해 실제 결절인지, 악성이 될 지 여부를 조사하게 된다.
  
- 결절
  - 종양(tumor) : 증식하는 세포로 이루어진 조직 덩어리
    - 종양은 양성(benign), 악성(malignant - cancer)
    - 폐에 있는 작은 종양을 폐결절(lung nodule)이라고 한다.
      - 이 중 40%는 악성
### 작업 순서
1. 원본 CT 스캔 데이터를 파이토치가 사용할 수 있는 형태로 읽는다.
2. segmentation
   - 파이토치를 사용하여 폐의 잠재적 결절에 해당하는 복셀을 찾는다.
   - 히트맵을 작성하는 것과 유사, 3번째 단계의 분류기에서 사용한다.
   - 관심없는 해부학적 부위는 무시하고 폐 내부의 잠재적 종양에 더 집중할 수 있다.
3. 관심 있는 복셀들을 덩어리(후보 결졀)로 묶는다.
   - 우리가 만든 히트맵에서 각 핫 스팟의 개략적인 중심부를 찾는 과정을 진행한다.
   - 각각의 결절은 인덱스가 부여되며 중심부에서 시작하는 열과 행으로 위치를 알 수 있다.
   - 이러한 제약을 가해 단순해진 문제를 최종 분류기에 전달한다.
4. 3차원 컨볼루션을 사용하여 각 후보 결절이 실제 결절인지 아닌지로 분류한다.
5. 각 결절별로 분류한 결과를 종합하여 환자를 진단한다.
   - 결절이 양성인지 악성인지를 영상 데이터에만 의존해서 판별해볼 것이다.
   - 결절별로 악성 예측을 구한 후 이들의 최댓값을 사용하는 방식으로 하나라도 악성이 예측된 경우, 해당 환자는 암 소견이 보인다고 진단한다.
  
### 9.4.1 신경망이 동작할 때까지 데이터를 던져넣을 수 없는 이유
### 9.4.2 결절이란 무엇인가
- 결절이란 폐 내부에서 나타날 수 있는 무수한 돌기 덩어리
  - 결절의 크기는 3센티미터 이하여야하며, 이보다 클 경우에 폐 종괴(lung mass)라 부른다.
    찾아내려는 암은 항상 결절의 형태를 띨 것이며, 이 결절은 밀도가 매우 낮은 폐 조직에 매달려 있거나 폐 벽에 붙어있을 거라는 점이다.
  - 따라서 분류기는 모든 조직을 검사할 필요없이 결절에만 집중하면 된다.
  - <img width="492" height="341" alt="image" src="https://github.com/user-attachments/assets/118dbd44-16c1-4c1b-ac70-f84f38a7af37" />

### 9.4.3 LUNA 데이터셋
- 결절 탐지 nodule detection - segmentation 단계
- 거짓 양성 감소(false positive reduction) - 3번째 분류 단계와 유사
- 잠재적 결절 위치 - 13장 내용과 유사


